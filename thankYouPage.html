<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thank You - ToyyinPay</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    background: #f3f4f6;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    text-align: center;
  }
  .container {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    max-width: 350px;
    width: 90%;
  }
  h1 {
    color: #2e7d32;
    margin-bottom: 10px;
  }
  p {
    color: #555;
    font-size: 1rem;
    margin-bottom: 20px;
  }
  button {
    background-color: #2196f3;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
  }
  button:hover {
    background-color: #1976d2;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Thank You!</h1>
  <p>Your campsite booking is confirmed. Weâ€™ll prepare your spot and see you soon!</p>
  <button onclick="sendThankYou()">Back to Chat</button>
</div>

<script>
const FIXED_USER_ID = "e21f3911-4de7-475d-b77a-72064094c172";
const CHAT_URL = "https://venturerush.up.railway.app/lite/mk-ai-chatbot/?m=channel-web&v=Fullscreen&options=%7B%22hideWidget%22%3Atrue%2C%22config%22%3A%7B%22enableReset%22%3Atrue%2C%22enableTranscriptDownload%22%3Atrue%7D%7D";

async function sendThankYou() {
  try {
    // 1. Login to get JWT
    const loginRes = await fetch("https://venturerush.up.railway.app/api/v1/auth/login/basic/default", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email: "venturerush.cs@gmail.com",
        password: "venturerush123"
      })
    });
    const loginData = await loginRes.json();
    const jwt = loginData.payload.jwt;

    // 2. Get sessions
    const sessionsRes = await fetch("https://venturerush.up.railway.app/api/v1/bots/mk-ai-chatbot/mod/hitl/sessions", {
      headers: { "Authorization": `Bearer ${jwt}` }
    });
    const sessions = await sessionsRes.json();

    // 3. Find session for fixed userId
    const session = sessions.find(s => s.user?.id === FIXED_USER_ID);
    if (!session) {
      alert("No session found for this user.");
      window.location.href = CHAT_URL;
      return;
    }

    // 4. Send message to that session
    await fetch(`https://venturerush.up.railway.app/api/v1/bots/mk-ai-chatbot/mod/hitl/sessions/${session.id}/message`, {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${jwt}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ message: "Thank you" })
    });

    // 5. Redirect to chat
    window.location.href = CHAT_URL;

  } catch (err) {
    console.error(err);
    window.location.href = CHAT_URL;
  }
}
</script>

</body>
</html>
